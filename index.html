<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>ç®—æœ¯ç»ƒä¹ ç”Ÿæˆå™¨ Â· å¤æ‚åˆ†æ•°åŠ å¼ºç‰ˆï¼ˆè¡¨è¾¾ä¼˜åŒ–ï¼‰</title>
    <style>
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: #f0f7fb;
            margin: 0;
            padding: 30px 15px;
            display: flex;
            justify-content: center;
        }
        .container {
            max-width: 1200px;
            width: 100%;
        }
        h1 {
            text-align: center;
            color: #1a3e60;
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 1.8rem;
        }
        .sub {
            text-align: center;
            color: #4a6a7f;
            margin-bottom: 15px;
            font-style: italic;
            font-size: 1rem;
        }
        .wechat-alert {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 16px;
            padding: 18px 20px;
            margin-bottom: 25px;
            color: #721c24;
            text-align: left;
            font-size: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .wechat-alert strong {
            font-size: 1.1rem;
            display: block;
            margin-bottom: 8px;
        }
        .wechat-alert ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .wechat-alert .tip-highlight {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        button {
            background: white;
            border: 2px solid #2a9d8f;
            color: #2a9d8f;
            font-size: 1.2rem;
            padding: 12px 20px;
            border-radius: 40px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            -webkit-tap-highlight-color: transparent;
            flex: 1 0 auto;
            min-width: 200px;
        }
        button:active {
            background: #2a9d8f;
            color: white;
            border-color: #1e7a6f;
            transform: scale(0.97);
        }
        .section {
            background: white;
            border-radius: 24px;
            box-shadow: 0 8px 20px rgba(0,30,50,0.1);
            padding: 25px 20px;
            margin-bottom: 30px;
            border: 1px solid #d9e6f2;
        }
        .section h2 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #0b4b6b;
            font-weight: 500;
            border-left: 6px solid #2a9d8f;
            padding-left: 15px;
            font-size: 1.6rem;
        }
        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 15px;
        }
        .question-item {
            background: #f8fbfe;
            border: 1px solid #cbdde8;
            border-radius: 20px;
            padding: 12px 16px;
            font-size: 1.2rem;
            font-weight: 500;
            color: #0a3142;
            display: flex;
            align-items: baseline;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            word-break: break-word;
        }
        .number {
            color: #2a9d8f;
            font-weight: 600;
            margin-right: 12px;
            font-size: 1.1rem;
            min-width: 30px;
        }
        .expr {
            font-family: 'Courier New', monospace;
            letter-spacing: 0.5px;
            line-height: 1.4;
        }
        .footer {
            text-align: center;
            color: #5a7e8c;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        .emergency-box {
            background: #e2f0d9;
            border: 1px solid #a3c9a0;
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        .emergency-box p {
            margin: 8px 0;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§® ç®—æœ¯ç»ƒä¹ ç”Ÿæˆå™¨ Â· è¿›é˜¶åˆ†æ•°ç‰ˆ</h1>
        <div class="sub">åˆ†æ•°å·²åŒ–ç®€ Â· é¿å…â€œäººå+äººâ€é”™è¯¯è¡¨è¾¾</div>

        <!-- å¾®ä¿¡ç¯å¢ƒæ£€æµ‹ä¸æç¤ºï¼ˆåŠ¨æ€æ˜¾ç¤ºï¼‰ -->
        <div id="wechatHint" class="wechat-alert" style="display: none;">
            <strong>âš ï¸ å¾®ä¿¡å†…ç‚¹å‡»æŒ‰é’®æ— ååº”ï¼Ÿ</strong>
            <ul>
                <li>1ï¸âƒ£ ç‚¹å‡»å³ä¸Šè§’ <strong>Â·Â·Â·</strong></li>
                <li>2ï¸âƒ£ é€‰æ‹© <strong>â€œåœ¨æµè§ˆå™¨æ‰“å¼€â€</strong>ï¼ˆå¦‚Chromeã€Safariï¼‰</li>
                <li>3ï¸âƒ£ åœ¨æµè§ˆå™¨ä¸­å³å¯æ­£å¸¸ä½¿ç”¨</li>
            </ul>
            <div class="tip-highlight">
                ğŸ’¡ å¦‚æœä»ç„¶æ— æ³•æ‰“å¼€ï¼Œè¯·å°è¯•å°†æ–‡ä»¶ä¿å­˜åˆ°æ‰‹æœºåï¼Œç”¨æ–‡ä»¶ç®¡ç†å™¨æ‰¾åˆ°è¯¥æ–‡ä»¶ï¼Œé€‰æ‹©ã€Œæ‰“å¼€æ–¹å¼ã€ä¸ºæµè§ˆå™¨ã€‚
            </div>
        </div>

        <div class="controls">
            <button onclick="generateBasic()">ä¹˜é™¤ + è„±å¼ (21é¢˜)</button>
            <button onclick="generateFraction()">åˆ†æ•°å€æ•° (8é¢˜ Â· å«å¤æ‚ç±»å‹)</button>
            <button onclick="generateAll()">å…¨éƒ¨ (29é¢˜ Â· åŠ å¼ºç‰ˆ)</button>
        </div>

        <!-- é¢˜ç›®å®¹å™¨ -->
        <div id="questionsContainer"></div>

        <!-- å¤‡ç”¨æ–¹æ¡ˆï¼šå¦‚æœæŒ‰é’®å®Œå…¨æ— æ³•ç‚¹å‡»ï¼Œå¯æ‰‹åŠ¨è§¦å‘ï¼ˆä½†éœ€è¦JSï¼‰ -->
        <div class="emergency-box" id="emergencyBox" style="display: none;">
            <p>ğŸ”§ å¦‚æœä¸Šæ–¹æŒ‰é’®æ— æ³•ç‚¹å‡»ï¼Œè¯·å°è¯•ä»¥ä¸‹ç´§æ€¥æ–¹æ³•ï¼š</p>
            <p>ğŸ‘‡ ç‚¹å‡»ä¸‹æ–¹æ–‡å­—æ¨¡æ‹Ÿç‚¹å‡»ï¼ˆéƒ¨åˆ†æ‰‹æœºæ”¯æŒï¼‰</p>
            <p><a href="javascript:void(0)" onclick="generateBasic()">ã€ç”Ÿæˆä¹˜é™¤è„±å¼ã€‘</a> | 
               <a href="javascript:void(0)" onclick="generateFraction()">ã€ç”Ÿæˆåˆ†æ•°å€æ•°ã€‘</a> | 
               <a href="javascript:void(0)" onclick="generateAll()">ã€ç”Ÿæˆå…¨éƒ¨ã€‘</a>
            </p>
            <p style="font-size:0.9rem; color:#666;">è‹¥ä»æ— æ•ˆï¼Œè¯·æŒ‰ä¸Šæ–¹æç¤ºç”¨æµè§ˆå™¨æ‰“å¼€ã€‚</p>
        </div>

        <div class="footer">
            çº¯å‰ç«¯ç”Ÿæˆ Â· æ¯æ¬¡ç‚¹å‡»é‡æ–°éšæœº Â· äººåæ­é…ç‰©å“
        </div>
    </div>

    <script>
        // ==================== ç¯å¢ƒæ£€æµ‹ ====================
        (function() {
            var ua = navigator.userAgent.toLowerCase();
            var isWechat = ua.indexOf('micromessenger') !== -1;
            var isFileProtocol = window.location.protocol === 'file:';
            
            if (isWechat && isFileProtocol) {
                var hint = document.getElementById('wechatHint');
                if (hint) hint.style.display = 'block';
                var emergency = document.getElementById('emergencyBox');
                if (emergency) emergency.style.display = 'block';
            }
        })();

        // ==================== å·¥å…·å‡½æ•° ====================
        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }
        function lcm(a, b) {
            return a * b / gcd(a, b);
        }
        function reduceFraction(numerator, denominator) {
            let g = gcd(numerator, denominator);
            return [numerator / g, denominator / g];
        }
        function randInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // ==================== å¯¹è±¡ç±»åˆ«ä¸å•ä½å®šä¹‰ ====================
        const OBJECT_CATEGORIES = {
            tree: ['è‹¹æœæ ‘', 'æ¢¨æ ‘', 'æ¡ƒæ ‘', 'æŸ³æ ‘', 'æ¨æ ‘'],
            book: ['æ•…äº‹ä¹¦', 'ç§‘æŠ€ä¹¦', 'æ–‡è‰ºä¹¦', 'æ¼«ç”»ä¹¦'],
            stationery: ['é“…ç¬”', 'é’¢ç¬”', 'åœ†ç ç¬”', 'æ¯›ç¬”'],
            sport: ['ç¯®çƒ', 'è¶³çƒ', 'æ’çƒ'],
            person: ['ç”·ç”Ÿ', 'å¥³ç”Ÿ'],
            flower: ['çº¢èŠ±', 'é»„èŠ±', 'ç´«èŠ±'],
            other: ['é‚®ç¥¨', 'æœ¬å­', 'ç»ç’ƒçƒ']
        };

        const ALL_OBJECTS = Object.values(OBJECT_CATEGORIES).flat();
        // éäººç‰©å“åˆ—è¡¨ï¼ˆç”¨äºå€æ•°é¢˜ï¼Œé¿å…â€œå°æ˜æœ‰13åå¥³ç”Ÿâ€ï¼‰
        const NON_PERSON_OBJECTS = ALL_OBJECTS.filter(obj => {
            let cat = Object.keys(OBJECT_CATEGORIES).find(c => OBJECT_CATEGORIES[c].includes(obj));
            return cat !== 'person';
        });

        const CATEGORY_NAMES = {
            tree: 'æ ‘', book: 'ä¹¦', stationery: 'ç¬”', sport: 'çƒ', person: 'äºº', flower: 'èŠ±', other: 'ç‰©å“'
        };

        function getCategory(obj) {
            for (let [cat, items] of Object.entries(OBJECT_CATEGORIES)) {
                if (items.includes(obj)) return cat;
            }
            return 'other';
        }

        function getUnit(obj) {
            if (obj === 'ç”·ç”Ÿ' || obj === 'å¥³ç”Ÿ') return 'å';
            if (/æ ‘|æ¨|æŸ³|æ¡ƒ|æ¢¨/.test(obj)) return 'æ£µ';
            if (/ä¹¦/.test(obj)) return 'æœ¬';
            if (/ç¬”|é“…ç¬”|é’¢ç¬”|åœ†ç ç¬”|æ¯›ç¬”/.test(obj)) return 'æ”¯';
            if (/çƒ/.test(obj)) return 'ä¸ª';
            if (/èŠ±/.test(obj)) return 'æœµ';
            if (obj === 'é‚®ç¥¨') return 'å¼ ';
            if (obj === 'æœ¬å­') return 'ä¸ª';
            if (obj === 'ç»ç’ƒçƒ') return 'é¢—';
            if (obj === 'ä¸€æ®µè·¯' || obj === 'ä¸€æ ¹ç»³å­' || obj === 'ä¸€æ ¹é’¢ç®¡') return 'ç±³';
            return 'ä¸ª';
        }

        // ==================== ä¹˜é™¤ä¸€ä½æ•° ====================
        function genSimpleQuestion() {
            if (Math.random() < 0.5) {
                let a = randInt(100, 999);
                let b = randInt(2, 9);
                return `${a} Ã— ${b} =`;
            } else {
                let divisor = randInt(2, 9);
                let minQuotient = Math.ceil(100 / divisor);
                let maxQuotient = Math.floor(999 / divisor);
                let quotient = randInt(minQuotient, maxQuotient);
                let dividend = divisor * quotient;
                return `${dividend} Ã· ${divisor} =`;
            }
        }

        // ==================== ä¸¤æ­¥è„±å¼ ====================
        function safeCalc(op1, op2, operator) {
            if (operator === '+') return op1 + op2;
            if (operator === '-') return op1 >= op2 ? op1 - op2 : null;
            if (operator === 'Ã—' || operator === '*') return op1 * op2;
            if (operator === 'Ã·' || operator === '/') {
                if (op2 !== 0 && op1 % op2 === 0) return op1 / op2;
                return null;
            }
            return null;
        }

        function genTwoStepQuestion() {
            const operators = ['+', '-', 'Ã—', 'Ã·'];
            for (let attempt = 0; attempt < 500; attempt++) {
                let parenPos = randInt(0, 1);
                let op1 = operators[randInt(0, 3)];
                let op2 = operators[randInt(0, 3)];
                let a = randInt(1, 99);
                let b = randInt(1, 99);
                let c = randInt(1, 99);

                if (parenPos === 0) {
                    let inner = safeCalc(a, b, op1);
                    if (inner === null || inner > 999) continue;
                    let final = safeCalc(inner, c, op2);
                    if (final === null || final > 999) continue;
                    return `(${a} ${op1} ${b}) ${op2} ${c} =`;
                } else {
                    let inner = safeCalc(b, c, op2);
                    if (inner === null || inner > 999) continue;
                    let final = safeCalc(a, inner, op1);
                    if (final === null || final > 999) continue;
                    return `${a} ${op1} (${b} ${op2} ${c}) =`;
                }
            }
            return "(12 + 34) Ã— 5 =";
        }

        // ==================== å¤æ‚åˆ†æ•°åº”ç”¨é¢˜ ====================
        function genFractionQuestion() {
            const types = [
                "æ±‚ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡ ",      // 0
                "å·²çŸ¥ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡ æ±‚åŸæ•°", // 1
                "æ±‚ä¸€ä¸ªæ•°æ˜¯å¦ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡ ", // 2
                "è¿ç»­æ±‚ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡ ",    // 3
                "åˆ†æ•°ç­‰é‡å…³ç³»",            // 4
                "å·²çŸ¥åˆ†ç‡å·®æ±‚å•ä½1",        // 5
                "åˆ†æ•°éƒ¨åˆ†å’Œ"               // 6
            ];
            let t = types[randInt(0, types.length - 1)];

            // ---------- ç±»å‹0ï¼šæ±‚ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡  ----------
            if (t === "æ±‚ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡ ") {
                for (let attempt = 0; attempt < 100; attempt++) {
                    let numerator = randInt(1, 5);
                    let denominator = randInt(numerator + 1, 8);
                    let [n, d] = reduceFraction(numerator, denominator);
                    let base = randInt(5, 30) * d;
                    let whole = base * randInt(1, 5);
                    let obj = ALL_OBJECTS[randInt(0, ALL_OBJECTS.length - 1)];
                    let unit = getUnit(obj);
                    let cat = getCategory(obj);
                    let otherName = CATEGORY_NAMES[cat] || 'ç‰©å“';
                    return `æœå›­é‡Œæœ‰${obj}${whole}${unit}ï¼Œå¦ä¸€ç§${otherName}çš„æ•°é‡æ˜¯å®ƒçš„${n}/${d}ï¼Œå¦ä¸€ç§${otherName}æœ‰å¤šå°‘${unit}ï¼Ÿ`;
                }
                return `æœå›­é‡Œæœ‰è‹¹æœæ ‘120æ£µï¼Œå¦ä¸€ç§æ ‘çš„æ•°é‡æ˜¯å®ƒçš„1/3ï¼Œå¦ä¸€ç§æ ‘æœ‰å¤šå°‘æ£µï¼Ÿ`;
            }

            // ---------- ç±»å‹1ï¼šå·²çŸ¥ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡ æ±‚åŸæ•° ----------
            if (t === "å·²çŸ¥ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡ æ±‚åŸæ•°") {
                const specialObjs = ["ä¸€æœ¬ä¹¦", "ä¸€è¢‹ç±³", "ä¸€ç­è‹¹æœ", "ä¸€æ®µè·¯", "ä¸€å †ç…¤"];
                const unitMap = {
                    "ä¸€æœ¬ä¹¦": "é¡µ", "ä¸€è¢‹ç±³": "åƒå…‹", "ä¸€ç­è‹¹æœ": "ä¸ª", "ä¸€æ®µè·¯": "ç±³", "ä¸€å †ç…¤": "å¨"
                };
                const actionMap = {
                    "ä¸€æœ¬ä¹¦": ["çœ‹äº†", "è¯»äº†"],
                    "ä¸€è¢‹ç±³": ["åƒäº†", "ç”¨å»"],
                    "ä¸€ç­è‹¹æœ": ["åƒäº†", "å–å‡º"],
                    "ä¸€æ®µè·¯": ["èµ°äº†", "ä¿®äº†"],
                    "ä¸€å †ç…¤": ["ç”¨äº†", "è¿èµ°"]
                };
                let obj = specialObjs[randInt(0, specialObjs.length - 1)];
                let unit = unitMap[obj];
                let actions = actionMap[obj];
                let action = actions[randInt(0, actions.length - 1)];
                for (let attempt = 0; attempt < 100; attempt++) {
                    let numerator = randInt(1, 5);
                    let denominator = randInt(numerator + 1, 8);
                    let [n, d] = reduceFraction(numerator, denominator);
                    let whole = randInt(5, 30) * d;
                    let part = whole * n / d;
                    let desc;
                    if (obj === "ä¸€æœ¬ä¹¦") desc = `${obj}ï¼Œ${action}å…¨ä¹¦çš„${n}/${d}`;
                    else if (obj === "ä¸€è¢‹ç±³") desc = `${obj}ï¼Œ${action}è¿™è¢‹ç±³çš„${n}/${d}`;
                    else if (obj === "ä¸€ç­è‹¹æœ") desc = `${obj}ï¼Œ${action}è¿™ç­è‹¹æœçš„${n}/${d}`;
                    else if (obj === "ä¸€æ®µè·¯") desc = `${obj}ï¼Œ${action}å…¨ç¨‹çš„${n}/${d}`;
                    else desc = `${obj}ï¼Œ${action}è¿™å †ç…¤çš„${n}/${d}`;
                    return `${desc}ï¼Œæ­£å¥½æ˜¯${part}${unit}ï¼Œ${obj}å…±æœ‰å¤šå°‘${unit}ï¼Ÿ`;
                }
                return `ä¸€æœ¬ä¹¦ï¼Œè¯»äº†å…¨ä¹¦çš„1/3ï¼Œæ­£å¥½æ˜¯30é¡µï¼Œè¿™æœ¬ä¹¦å…±æœ‰å¤šå°‘é¡µï¼Ÿ`;
            }

            // ---------- ç±»å‹2ï¼šæ±‚ä¸€ä¸ªæ•°æ˜¯å¦ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡  ----------
            if (t === "æ±‚ä¸€ä¸ªæ•°æ˜¯å¦ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡ ") {
                let categories = Object.keys(OBJECT_CATEGORIES);
                let cat, items;
                do {
                    cat = categories[randInt(0, categories.length - 1)];
                    items = OBJECT_CATEGORIES[cat];
                } while (items.length < 2);
                let idx1 = randInt(0, items.length - 1);
                let idx2;
                do {
                    idx2 = randInt(0, items.length - 1);
                } while (idx2 === idx1);
                let obj1 = items[idx1];
                let obj2 = items[idx2];
                let unit1 = getUnit(obj1);
                let unit2 = getUnit(obj2);
                let a = randInt(10, 50);
                let b = randInt(10, 50);
                return `å­¦æ ¡æœ‰${obj1}${a}${unit1}ï¼Œ${obj2}${b}${unit2}ï¼Œ${obj1}çš„æ•°é‡æ˜¯${obj2}çš„å‡ åˆ†ä¹‹å‡ ï¼Ÿ`;
            }

            // ---------- ç±»å‹3ï¼šè¿ç»­æ±‚ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡  ----------
            if (t === "è¿ç»­æ±‚ä¸€ä¸ªæ•°çš„å‡ åˆ†ä¹‹å‡ ") {
                let catNames = Object.keys(OBJECT_CATEGORIES);
                let cat;
                let items;
                do {
                    cat = catNames[randInt(0, catNames.length - 1)];
                    items = OBJECT_CATEGORIES[cat];
                } while (items.length < 2);
                let obj1, obj2, obj3;
                if (items.length >= 3) {
                    let shuffled = [...items].sort(() => Math.random() - 0.5);
                    obj1 = shuffled[0];
                    obj2 = shuffled[1];
                    obj3 = shuffled[2];
                } else {
                    obj1 = items[0];
                    obj2 = items[1];
                    obj3 = "å¦ä¸€ç§" + (CATEGORY_NAMES[cat] || 'ç‰©å“');
                }
                let unit1 = getUnit(obj1);
                let unit2 = getUnit(obj2);
                let unit3 = (obj3.startsWith("å¦ä¸€ç§") ? unit1 : getUnit(obj3));
                for (let attempt = 0; attempt < 300; attempt++) {
                    let whole1 = randInt(30, 150) * 2;
                    let n1 = randInt(1, 4);
                    let d1 = randInt(n1 + 1, 7);
                    let [n1r, d1r] = reduceFraction(n1, d1);
                    if ((whole1 * n1r) % d1r !== 0) continue;
                    let mid = whole1 * n1r / d1r;
                    if (mid > 600) continue;
                    let n2 = randInt(1, 4);
                    let d2 = randInt(n2 + 1, 7);
                    let [n2r, d2r] = reduceFraction(n2, d2);
                    if ((mid * n2r) % d2r !== 0) continue;
                    let result = mid * n2r / d2r;
                    if (result > 0 && result < 1000 && Number.isInteger(result)) {
                        return `${obj1}æœ‰${whole1}${unit1}ï¼Œ${obj2}çš„æ•°é‡æ˜¯${obj1}çš„${n1r}/${d1r}ï¼Œ${obj3}çš„æ•°é‡æ˜¯${obj2}çš„${n2r}/${d2r}ï¼Œ${obj3}æœ‰å¤šå°‘${unit3}ï¼Ÿ`;
                    }
                }
                return `è‹¹æœæ ‘æœ‰120æ£µï¼Œæ¢¨æ ‘çš„æ•°é‡æ˜¯è‹¹æœæ ‘çš„2/3ï¼Œæ¡ƒæ ‘çš„æ•°é‡æ˜¯æ¢¨æ ‘çš„3/4ï¼Œæ¡ƒæ ‘æœ‰å¤šå°‘æ£µï¼Ÿ`;
            }

            // ---------- ç±»å‹4ï¼šåˆ†æ•°ç­‰é‡å…³ç³» ----------
            if (t === "åˆ†æ•°ç­‰é‡å…³ç³»") {
                let catNames = Object.keys(OBJECT_CATEGORIES);
                let cat1 = catNames[randInt(0, catNames.length - 1)];
                let cat2 = catNames[randInt(0, catNames.length - 1)];
                let items1 = OBJECT_CATEGORIES[cat1];
                let items2 = OBJECT_CATEGORIES[cat2];
                let obj1 = items1[randInt(0, items1.length - 1)];
                let obj2 = items2[randInt(0, items2.length - 1)];
                let unit1 = getUnit(obj1);
                let unit2 = getUnit(obj2);
                for (let attempt = 0; attempt < 200; attempt++) {
                    let a1 = randInt(1, 5);
                    let b1 = randInt(a1 + 1, 8);
                    let [a1r, b1r] = reduceFraction(a1, b1);
                    let a2 = randInt(1, 5);
                    let b2 = randInt(a2 + 1, 8);
                    let [a2r, b2r] = reduceFraction(a2, b2);
                    let k = randInt(2, 15);
                    let B = k * a1r * b2r;
                    let A = k * a2r * b1r;
                    if (A < 1000 && B < 1000 && A > 0 && B > 0) {
                        return `${obj1}çš„${a1r}/${b1r}ç­‰äº${obj2}çš„${a2r}/${b2r}ï¼Œå·²çŸ¥${obj2}æœ‰${B}${unit2}ï¼Œ${obj1}æœ‰å¤šå°‘${unit1}ï¼Ÿ`;
                    }
                }
                return `ç”²æ•°çš„1/3ç­‰äºä¹™æ•°çš„2/5ï¼Œä¹™æ•°æ˜¯30ï¼Œç”²æ•°æ˜¯å¤šå°‘ï¼Ÿ`;
            }

            // ---------- ç±»å‹5ï¼šå·²çŸ¥åˆ†ç‡å·®æ±‚å•ä½1 ----------
            if (t === "å·²çŸ¥åˆ†ç‡å·®æ±‚å•ä½1") {
                let pairs = [
                    ['ç”·ç”Ÿ', 'å¥³ç”Ÿ'],
                    ['è‹¹æœæ ‘', 'æ¢¨æ ‘'],
                    ['æ•…äº‹ä¹¦', 'ç§‘æŠ€ä¹¦'],
                    ['çº¢èŠ±', 'é»„èŠ±']
                ];
                let pair = pairs[randInt(0, pairs.length - 1)];
                let objA = pair[0];
                let objB = pair[1];
                let unit = getUnit(objA);
                for (let attempt = 0; attempt < 100; attempt++) {
                    let d = randInt(3, 8);
                    let n = randInt(1, 2);
                    let [nr, dr] = reduceFraction(n, d);
                    let tVal = randInt(3, 15);
                    let diff = nr * tVal;
                    let B = dr * tVal;
                    let A = B + diff;
                    if (A < 500 && B < 500 && diff < 200) {
                        return `${objA}æ¯”${objB}å¤š${nr}/${dr}ï¼Œä¸”${objA}æ¯”${objB}å¤š${diff}${unit}ï¼Œ${objB}æœ‰å¤šå°‘${unit}ï¼Ÿ${objA}æœ‰å¤šå°‘${unit}ï¼Ÿ`;
                    }
                }
                return `ç”·ç”Ÿæ¯”å¥³ç”Ÿå¤š1/4ï¼Œä¸”ç”·ç”Ÿæ¯”å¥³ç”Ÿå¤š5äººï¼Œå¥³ç”Ÿæœ‰å¤šå°‘äººï¼Ÿ`;
            }

            // ---------- ç±»å‹6ï¼šåˆ†æ•°éƒ¨åˆ†å’Œ ----------
            if (t === "åˆ†æ•°éƒ¨åˆ†å’Œ") {
                const lengthObjs = [
                    { name: 'ä¸€æ®µè·¯', verbs: ['ä¿®äº†', 'èµ°äº†'] },
                    { name: 'ä¸€æ ¹ç»³å­', verbs: ['ç”¨å»', 'å‰ªå»'] },
                    { name: 'ä¸€æ ¹é’¢ç®¡', verbs: ['ç”¨å»', 'é”¯ä¸‹'] }
                ];
                let idx = randInt(0, lengthObjs.length - 1);
                let obj = lengthObjs[idx].name;
                let verbs = lengthObjs[idx].verbs;
                let verb = verbs[randInt(0, verbs.length - 1)];
                let unit = 'ç±³';
                for (let attempt = 0; attempt < 300; attempt++) {
                    let d1 = randInt(2, 8);
                    let n1 = randInt(1, d1 - 1);
                    let d2 = randInt(2, 8);
                    let n2 = randInt(1, d2 - 1);
                    let [n1r, d1r] = reduceFraction(n1, d1);
                    let [n2r, d2r] = reduceFraction(n2, d2);
                    if (n1r/d1r + n2r/d2r > 1) continue;
                    let lcmVal = lcm(d1r, d2r);
                    let k = randInt(2, 15);
                    let total = lcmVal * k;
                    let use1 = total * n1r / d1r;
                    let use2 = total * n2r / d2r;
                    if (Number.isInteger(use1) && Number.isInteger(use2) && use1 + use2 <= total) {
                        if (Math.random() < 0.5) {
                            return `${obj}å…¨é•¿${total}${unit}ï¼Œç¬¬ä¸€æ¬¡${verb}å…¨é•¿çš„${n1r}/${d1r}ï¼Œç¬¬äºŒæ¬¡${verb}å…¨é•¿çš„${n2r}/${d2r}ï¼Œä¸¤æ¬¡ä¸€å…±${verb}å¤šå°‘${unit}ï¼Ÿ`;
                        } else {
                            let remain = total - use1 - use2;
                            return `${obj}å…¨é•¿${total}${unit}ï¼Œç¬¬ä¸€æ¬¡${verb}å…¨é•¿çš„${n1r}/${d1r}ï¼Œç¬¬äºŒæ¬¡${verb}å…¨é•¿çš„${n2r}/${d2r}ï¼Œè¿˜å‰©å¤šå°‘${unit}ï¼Ÿ`;
                        }
                    }
                }
                return `ä¸€æ®µè·¯å…¨é•¿63ç±³ï¼Œç¬¬ä¸€æ¬¡ä¿®äº†å…¨é•¿çš„2/7ï¼Œç¬¬äºŒæ¬¡ä¿®äº†å…¨é•¿çš„3/7ï¼Œä¸¤æ¬¡ä¸€å…±ä¿®äº†å¤šå°‘ç±³ï¼Ÿ`;
            }

            return `æœå›­é‡Œæœ‰è‹¹æœæ ‘120æ£µï¼Œæ¢¨æ ‘æ˜¯è‹¹æœæ ‘çš„2/3ï¼Œæ¢¨æ ‘æœ‰å¤šå°‘æ£µï¼Ÿ`;
        }

        // ==================== å€æ•°åº”ç”¨é¢˜ï¼ˆç®€å•å€æ•°æ’é™¤äººç‰©å“ï¼‰ ====================
        function genMultipleQuestion() {
            const types = ["å’Œå€", "å·®å€", "ç®€å•å€æ•°"];
            let t = types[randInt(0, 2)];

            if (t === "å’Œå€") {
                let multiple = randInt(2, 5);
                let small = randInt(20, 100);
                let total = small * (multiple + 1);
                let categories = Object.keys(OBJECT_CATEGORIES);
                let cat, items;
                do {
                    cat = categories[randInt(0, categories.length - 1)];
                    items = OBJECT_CATEGORIES[cat];
                } while (items.length < 2);
                let idx1 = randInt(0, items.length - 1);
                let idx2;
                do {
                    idx2 = randInt(0, items.length - 1);
                } while (idx2 === idx1);
                let obj1 = items[idx1];
                let obj2 = items[idx2];
                let unit = getUnit(obj1); // åŒä¸€ç±»åˆ«ï¼Œå•ä½ä¸€è‡´
                return `${obj1}å’Œ${obj2}å…±æœ‰${total}${unit}ï¼Œ${obj1}çš„æ•°é‡æ˜¯${obj2}çš„${multiple}å€ï¼Œ${obj1}å’Œ${obj2}å„æœ‰å¤šå°‘${unit}ï¼Ÿ`;
            }

            if (t === "å·®å€") {
                let multiple = randInt(2, 6);
                let small = randInt(20, 80);
                let diff = small * (multiple - 1);
                let categories = Object.keys(OBJECT_CATEGORIES);
                let cat, items;
                do {
                    cat = categories[randInt(0, categories.length - 1)];
                    items = OBJECT_CATEGORIES[cat];
                } while (items.length < 2);
                let idx1 = randInt(0, items.length - 1);
                let idx2;
                do {
                    idx2 = randInt(0, items.length - 1);
                } while (idx2 === idx1);
                let obj1 = items[idx1];
                let obj2 = items[idx2];
                let unit = getUnit(obj1);
                return `${obj1}æ¯”${obj2}å¤š${diff}${unit}ï¼Œ${obj1}çš„æ•°é‡æ˜¯${obj2}çš„${multiple}å€ï¼Œ${obj1}å’Œ${obj2}å„æœ‰å¤šå°‘${unit}ï¼Ÿ`;
            }

            // ç®€å•å€æ•°ï¼šåªä»éäººç‰©å“ä¸­é€‰å–ï¼Œé¿å…â€œå°æ˜æœ‰13åå¥³ç”Ÿâ€
            let base = randInt(10, 50);
            let multiple = randInt(2, 8);
            let names = ["å°æ˜", "å°çº¢", "å°åˆš", "å°ä¸½", "å°å"];
            let name1 = names[randInt(0, names.length - 1)];
            let name2;
            do {
                name2 = names[randInt(0, names.length - 1)];
            } while (name2 === name1);
            // ä»éäººç‰©å“ä¸­éšæœºé€‰
            let obj = NON_PERSON_OBJECTS[randInt(0, NON_PERSON_OBJECTS.length - 1)];
            let unit = getUnit(obj);
            return `${name1}æœ‰${base}${unit}${obj}ï¼Œ${name2}çš„${obj}æ•°æ˜¯${name1}çš„${multiple}å€ï¼Œ${name2}æœ‰å¤šå°‘${unit}${obj}ï¼Ÿ`;
        }

        // ç”Ÿæˆ8é¢˜æ··åˆ
        function gen8FractionMultiple() {
            let questions = [];
            for (let i = 0; i < 4; i++) questions.push(genFractionQuestion());
            for (let i = 0; i < 4; i++) questions.push(genMultipleQuestion());
            // æ´—ç‰Œ
            for (let i = questions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [questions[i], questions[j]] = [questions[j], questions[i]];
            }
            return questions;
        }

        // ==================== æ¸²æŸ“å‡½æ•° ====================
        function renderQuestions(simpleList, twoStepList, fractionList) {
            const container = document.getElementById('questionsContainer');
            let html = '';

            if (simpleList.length > 0) {
                html += `<div class="section"><h2>ğŸ“Œ ä¸€ã€ä¸‰ä½æ•°ä¹˜é™¤ä¸€ä½æ•°ï¼ˆ${simpleList.length}é¢˜ï¼‰</h2><div class="question-grid">`;
                simpleList.forEach((q, idx) => {
                    html += `<div class="question-item"><span class="number">${idx+1}.</span><span class="expr">${q}</span></div>`;
                });
                html += '</div></div>';
            }

            if (twoStepList.length > 0) {
                html += `<div class="section"><h2>ğŸ“Œ äºŒã€ä¸¤æ­¥å¸¦å°æ‹¬å·è„±å¼è®¡ç®—ï¼ˆ${twoStepList.length}é¢˜ï¼‰</h2><div class="question-grid">`;
                twoStepList.forEach((q, idx) => {
                    html += `<div class="question-item"><span class="number">${idx+1}.</span><span class="expr">${q}</span></div>`;
                });
                html += '</div></div>';
            }

            if (fractionList.length > 0) {
                html += `<div class="section"><h2>ğŸ“Œ ä¸‰ã€åˆ†æ•°ä¸å€æ•°åº”ç”¨é¢˜ï¼ˆ${fractionList.length}é¢˜ Â· å«å¤æ‚ç±»å‹ï¼‰</h2><div class="question-grid" style="grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));">`;
                fractionList.forEach((q, idx) => {
                    html += `<div class="question-item"><span class="number">${idx+1}.</span><span class="expr">${q}</span></div>`;
                });
                html += '</div></div>';
            }

            if (html === '') {
                html = '<div style="text-align:center; padding:50px; color:#888;">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ç”Ÿæˆé¢˜ç›®</div>';
            }

            container.innerHTML = html;
        }

        // ==================== å…¨å±€å‡½æ•° ====================
        window.generateBasic = function() {
            let simple = [];
            for (let i = 0; i < 9; i++) simple.push(genSimpleQuestion());
            let twoStep = [];
            for (let i = 0; i < 12; i++) twoStep.push(genTwoStepQuestion());
            renderQuestions(simple, twoStep, []);
        };

        window.generateFraction = function() {
            let fraction = gen8FractionMultiple();
            renderQuestions([], [], fraction);
        };

        window.generateAll = function() {
            let simple = [];
            for (let i = 0; i < 9; i++) simple.push(genSimpleQuestion());
            let twoStep = [];
            for (let i = 0; i < 12; i++) twoStep.push(genTwoStepQuestion());
            let fraction = gen8FractionMultiple();
            renderQuestions(simple, twoStep, fraction);
        };

        renderQuestions([], [], []);
    </script>
</body>
</html>
